<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag Click Test - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tool-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .drag-zone {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%);
            border: 2px solid var(--card-border);
            border-radius: 2rem;
            margin: 2rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: 0.3s;
        }

        .drag-zone:hover {
            border-color: var(--primary);
        }

        .consistency-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        .consistency-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            border-radius: 1.5rem;
        }

        .stat-val {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem;">Drag Click Test</h1>
            <p style="color:var(--text-muted); margin-bottom: 3rem;">Measure the rapid-fire consistency of your drag
                clicking technique.</p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-val" id="cps">0.0</div>
                    <div class="stat-label">MAX CPS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="consistency">0%</div>
                    <div class="stat-label">CONSISTENCY</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="burst">0</div>
                    <div class="stat-label">LONGEST BURST</div>
                </div>
            </div>

            <div class="drag-zone" id="dragZone">
                <h2 style="font-size: 2rem; margin-bottom: 10px;">DRAG HERE</h2>
                <p style="color:var(--text-muted); font-weight:600">Continuous drag required for measurement</p>

                <div style="width: 300px;">
                    <div class="consistency-bar">
                        <div class="consistency-fill" id="fill"></div>
                    </div>
                </div>
            </div>

            <div
                style="margin-top: 3rem; text-align: left; background: rgba(0,0,0,0.2); padding: 2rem; border-radius: 1.5rem;">
                <h3 style="margin-bottom: 1rem">Measurement Logic</h3>
                <p style="color:var(--text-muted); line-height:1.6">Drag clicking happens in bursts. This tool
                    identifies the highest frequency burst of clicks and calculates the standard deviation in click
                    intervals to determine your consistency rating. Professional drag clickers aim for >20 CPS with >90%
                    consistency.</p>
            </div>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const zone = document.getElementById('dragZone');
        const cpsEl = document.getElementById('cps');
        const consEl = document.getElementById('consistency');
        const burstEl = document.getElementById('burst');
        const fill = document.getElementById('fill');

        let clickTimes = [];
        let maxCps = 0;
        let longestBurst = 0;
        let currentBurst = 0;
        let lastClick = 0;

        zone.onmousedown = (e) => {
            const now = performance.now();

            if (lastClick > 0) {
                const diff = now - lastClick;
                if (diff < 100) { // Burst window
                    currentBurst++;
                    clickTimes.push(diff);
                } else {
                    processBurst();
                    currentBurst = 1;
                    clickTimes = [];
                }
            } else {
                currentBurst = 1;
            }

            if (currentBurst > longestBurst) {
                longestBurst = currentBurst;
                burstEl.innerText = longestBurst;
            }

            lastClick = now;
            updateVisuals();
        };

        function processBurst() {
            if (clickTimes.length < 5) return;

            const avgInterval = clickTimes.reduce((a, b) => a + b) / clickTimes.length;
            const currentCps = 1000 / avgInterval;

            if (currentCps > maxCps) {
                maxCps = currentCps;
                cpsEl.innerText = maxCps.toFixed(1);
            }

            // Consistency (Coefficient of Variation)
            const variance = clickTimes.reduce((a, b) => a + Math.pow(b - avgInterval, 2), 0) / clickTimes.length;
            const stdDev = Math.sqrt(variance);
            const cv = stdDev / avgInterval;
            const consistency = Math.max(0, 100 - (cv * 100));
            consEl.innerText = Math.round(consistency) + '%';
            fill.style.width = consistency + '%';
        }

        function updateVisuals() {
            zone.style.background = `rgba(99, 102, 241, ${Math.min(0.2, currentBurst / 50)})`;
        }
    </script>
</body>

</html>