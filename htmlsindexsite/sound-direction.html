<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Direction Test - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tool-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .compass {
            width: 400px;
            height: 400px;
            border: 2px solid var(--card-border);
            border-radius: 50%;
            margin: 2rem auto;
            position: relative;
            background: radial-gradient(circle, #1f2937, #0d1117);
        }

        .head {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
        }

        .btn-dir {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #374151;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: 0.2s;
        }

        .btn-dir:hover {
            background: var(--primary);
        }

        /* Positions */
        .n {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .s {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .e {
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .w {
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .nw {
            top: 60px;
            left: 60px;
        }

        .ne {
            top: 60px;
            right: 60px;
        }

        .sw {
            bottom: 60px;
            left: 60px;
        }

        .se {
            bottom: 60px;
            right: 60px;
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem;">Sound Direction Test</h1>
            <p style="color:var(--text-muted); margin-bottom: 3rem;">Listen carefully (Use Headphones!) and click the
                direction the sound is coming from.</p>

            <div style="margin-bottom:2rem; font-size:1.5rem">Score: <span id="score">0</span></div>
            <button class="join-pro-btn" style="width:auto; margin-bottom:2rem" onclick="playSound()" id="playBtn">PLAY
                SOUND</button>

            <div class="compass">
                <div class="head">YOU</div>
                <div class="btn-dir n" onclick="guess('n')">N</div>
                <div class="btn-dir s" onclick="guess('s')">S</div>
                <div class="btn-dir e" onclick="guess('e')">E</div>
                <div class="btn-dir w" onclick="guess('w')">W</div>

                <div class="btn-dir nw" onclick="guess('nw')">NW</div>
                <div class="btn-dir ne" onclick="guess('ne')">NE</div>
                <div class="btn-dir sw" onclick="guess('sw')">SW</div>
                <div class="btn-dir se" onclick="guess('se')">SE</div>
            </div>

            <p id="feedback" style="height:20px; font-weight:bold"></p>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const scoreEl = document.getElementById('score');
        const feedback = document.getElementById('feedback');
        const playBtn = document.getElementById('playBtn');

        // Web Audio
        const ac = new (window.AudioContext || window.webkitAudioContext)();
        let currentDir = '';
        let score = 0;

        const directions = {
            'n': { x: 0, y: 0, z: -10 },
            's': { x: 0, y: 0, z: 10 }, // Behind/Front is hard in stereo without HRTF. 
            // WebAudio PannerNode default 'HRTF' panning model handles visual perception somewhat if supported.
            'e': { x: 10, y: 0, z: 0 },
            'w': { x: -10, y: 0, z: 0 },
            'nw': { x: -7, y: 0, z: -7 },
            'ne': { x: 7, y: 0, z: -7 },
            'sw': { x: -7, y: 0, z: 7 },
            'se': { x: 7, y: 0, z: 7 }
        };

        function playSound() {
            if (ac.state === 'suspended') ac.resume();

            playBtn.disabled = true;
            feedback.innerText = "Listening...";

            const dirs = Object.keys(directions);
            currentDir = dirs[Math.floor(Math.random() * dirs.length)];
            const pos = directions[currentDir];

            const osc = ac.createOscillator();
            const panner = ac.createPanner();
            const gain = ac.createGain();

            panner.panningModel = 'HRTF';
            panner.distanceModel = 'inverse';
            panner.positionX.value = pos.x;
            panner.positionY.value = pos.y;
            panner.positionZ.value = pos.z;

            osc.frequency.setValueAtTime(400, ac.currentTime); // Beep
            osc.type = 'triangle';

            osc.connect(panner);
            panner.connect(gain);
            gain.connect(ac.destination);

            gain.gain.setValueAtTime(0.5, ac.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + 0.5);

            osc.start();
            osc.stop(ac.currentTime + 0.5);
        }

        function guess(dir) {
            if (!currentDir) return;

            if (dir === currentDir) {
                feedback.innerText = "CORRECT!";
                feedback.style.color = "#10b981";
                score++;
                scoreEl.innerText = score;
            } else {
                feedback.innerText = `WRONG! It was ${currentDir.toUpperCase()}`;
                feedback.style.color = "#ef4444";
            }

            currentDir = '';
            playBtn.disabled = false;
        }
    </script>
</body>

</html>