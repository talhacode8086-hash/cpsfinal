<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Reflex Test - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tool-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .arena {
            height: 400px;
            background: #0d1117;
            border: 2px solid #374151;
            border-radius: 1rem;
            position: relative;
            margin: 2rem 0;
            cursor: crosshair;
            overflow: hidden;
        }

        .target {
            position: absolute;
            background: #f43f5e;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #f43f5e;
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem;">Pressure Reflex Test</h1>
            <p style="color:var(--text-muted); margin-bottom: 3rem;">Targets shrink rapidly. Click them before they
                vanish!</p>

            <div style="font-size:1.5rem; margin-bottom:1rem">Score: <span id="score" style="color:#f43f5e">0</span>
            </div>

            <div class="arena" id="arena" onclick="miss(event)">
                <div id="overlay"
                    style="position:absolute; inset:0; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:20">
                    <button class="join-pro-btn" style="width:auto" onclick="start()">START PRESSURE</button>
                </div>
            </div>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const arena = document.getElementById('arena');
        const scoreEl = document.getElementById('score');
        const overlay = document.getElementById('overlay');

        let score = 0;
        let isRunning = false;
        let spawnInterval;
        let targets = [];

        function start() {
            score = 0;
            scoreEl.innerText = 0;
            isRunning = true;
            overlay.style.display = 'none';
            targets.forEach(t => t.el.remove());
            targets = [];

            spawn();
            loop();
        }

        function spawn() {
            if (!isRunning) return;

            const size = 60;
            const t = document.createElement('div');
            t.className = 'target';
            t.style.width = size + 'px';
            t.style.height = size + 'px';

            const x = Math.random() * (arena.clientWidth - size);
            const y = Math.random() * (arena.clientHeight - size);

            t.style.left = x + 'px';
            t.style.top = y + 'px';

            t.onmousedown = (e) => {
                hit(obj);
                e.stopPropagation();
            };

            arena.appendChild(t);

            const obj = { el: t, size: size, shrinkRate: 0.3 + (score * 0.02) };
            targets.push(obj);

            // Random next spawn
            const delay = Math.max(500, 1500 - (score * 50));
            setTimeout(spawn, delay);
        }

        function loop() {
            if (!isRunning) return;

            targets.forEach((t, i) => {
                t.size -= t.shrinkRate;
                if (t.size <= 0) {
                    t.el.remove();
                    gameOver();
                } else {
                    t.el.style.width = t.size + 'px';
                    t.el.style.height = t.size + 'px';
                }
            });

            targets = targets.filter(t => t.size > 0);

            if (isRunning) requestAnimationFrame(loop);
        }

        function hit(obj) {
            if (!isRunning || !obj) return;
            score++;
            scoreEl.innerText = score;
            obj.el.remove();
            obj.size = 0; // Trigger filter remove
        }

        function miss(e) {
            if (isRunning && e.target === arena) {
                // gameOver(); // Strict mode?
            }
        }

        function gameOver() {
            isRunning = false;
            overlay.style.display = 'flex';
            overlay.innerHTML = `
                <div style='text-align:center'>
                    <h2>GAME OVER</h2>
                    <p>Score: ${score}</p>
                    <button class="join-pro-btn" style="width:auto; margin-top:1rem" onclick="start()">RETRY</button>
                </div>
            `;
        }
    </script>
</body>

</html>