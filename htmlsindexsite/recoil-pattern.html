<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recoil Pattern Trainer - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tool-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .canvas-container {
            position: relative;
            background: #0d1117;
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            margin: 2rem auto;
            width: 600px;
            height: 600px;
            cursor: crosshair;
        }

        canvas {
            display: block;
        }

        .controls {
            margin-bottom: 2rem;
        }

        .pattern-btn {
            background: #1f2937;
            border: 1px solid #374151;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }

        .pattern-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem;">Recoil Pattern Trainer</h1>
            <p style="color:var(--text-muted); margin-bottom: 2rem;">Counter the recoil by moving your mouse in the
                reverse pattern. Green line = Pattern, Red line = Your aim.</p>

            <div class="controls">
                <button class="pattern-btn active" onclick="setPattern('vertical')">Vertical</button>
                <button class="pattern-btn" onclick="setPattern('t-shape')">T-Shape</button>
                <button class="pattern-btn" onclick="setPattern('s-shape')">S-Shape</button>
                <button class="join-pro-btn" style="width:auto; margin-left:2rem" onclick="start()">START SPRAY</button>
            </div>

            <div class="canvas-container" id="container">
                <canvas id="canvas" width="600" height="600"></canvas>
            </div>

            <p id="feedback" style="height:20px; color:#10b981"></p>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const feedback = document.getElementById('feedback');

        // Patterns are arrays of [dx, dy] per tick (frame)
        const patterns = {
            'vertical': Array(60).fill([0, -2]), // Up recoil
            't-shape': [...Array(30).fill([0, -2]), ...Array(15).fill([-1, 0]), ...Array(15).fill([1, 0])],
            's-shape': [...Array(20).fill([0, -2]), ...Array(20).fill([1, -1]), ...Array(20).fill([-1, -1])]
        };

        let currentPattern = 'vertical';
        let isSpraying = false;
        let pIndex = 0;

        let patternX, patternY; // Where the recoil goes
        let mouseX, mouseY; // Where user aims
        let startX = 300, startY = 400; // Start center bottomish

        // We track "camera" aim. 
        // Real game: Crosshair moves up. You pull mouse down to keep crosshair center.
        // Simulator: We show "Target Goal" moving up. User must keep "Crosshair" on Target Goal?
        // OR: User holds mouse, we move a "recoil point" up, user must move mouse down to cancel it.
        // Let's do: User clicks start. A green ghost cursor starts moving (the recoil pattern). User controls red cursor. User must try to keep red cursor on center point (300, 300) while "recoil" pushes it?
        // Simpler: Draw the pattern. User traces it in reverse.

        // Approach: Ghost dot moves according to pattern. User must keep their crosshair on the ghost dot.
        // If pattern is Recoil (Up), Ghost moves Up. 
        // To counter Up recoil, you pull Down.
        // So target should stay at Center (300,300).
        // Recoil adds (0, -2). 
        // User Input adds (dx, dy).
        // Result Position += Recoil + UserInput.
        // Goal: Keep Result Position at Start.

        let aimX = 300, aimY = 300; // Current Impact Point

        canvas.addEventListener('mousemove', (e) => {
            if (!isSpraying) return;
            // In a browser, we can't lock pointer and get raw delta effortlessly without lockPointer().
            // Let's use RequestPointerLock for better experience.
        });

        canvas.onclick = () => {
            canvas.requestPointerLock();
        };

        document.addEventListener('mousemove', (e) => {
            if (document.pointerLockElement === canvas && isSpraying) {
                // Apply user input counter
                aimX += e.movementX;
                aimY += e.movementY;
            }
        });

        function setPattern(p) {
            currentPattern = p;
            document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function start() {
            isSpraying = true;
            pIndex = 0;
            aimX = 300; aimY = 300;
            canvas.requestPointerLock();
            feedback.innerText = "Counter the recoil!";
            loop();
        }

        function loop() {
            if (!isSpraying) return;

            ctx.clearRect(0, 0, 600, 600);

            // Draw Center Target
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.strokeRect(290, 290, 20, 20);

            // Apply Recoil
            if (pIndex < patterns[currentPattern].length) {
                const [dx, dy] = patterns[currentPattern][pIndex];
                // Recoil moves the gun UP (dy is negative usually means Up in screen coords, but let's say Recoil Kick is Up)
                // If recoil kicks UP, aimY decreases (0 is top).
                aimX += dx;
                aimY += dy;
                pIndex++;
            } else {
                end();
                return;
            }

            // Draw Impact Point
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(aimX, aimY, 5, 0, Math.PI * 2);
            ctx.fill();

            // Score/Accuracy check
            // Distance from 300,300
            const dist = Math.sqrt(Math.pow(aimX - 300, 2) + Math.pow(aimY - 300, 2));
            if (dist < 20) feedback.innerText = "Perfect Control";
            else if (dist < 50) feedback.innerText = "Okay...";
            else feedback.innerText = "Drifting!";

            requestAnimationFrame(loop);
        }

        function end() {
            isSpraying = false;
            document.exitPointerLock();
            feedback.innerText = "Finished pattern.";
        }
    </script>
</body>

</html>