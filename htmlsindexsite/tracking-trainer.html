<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking Trainer - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <style>
        .tool-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .arena {
            height: 400px;
            background: #111;
            border: 2px solid var(--card-border);
            border-radius: 1rem;
            position: relative;
            margin: 2rem 0;
            overflow: hidden;
            cursor: none;
            /* Hide cursor */
        }

        .cursor {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .path {
            position: absolute;
            background: #374151;
            width: 100%;
            height: 6px;
            top: 50%;
            left: 0;
            transform: translateY(-3px);
            z-index: 1;
        }

        .target-box {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 2px solid #ef4444;
            top: 50%;
            left: 0;
            transform: translate(-50%, -50%);
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem;">Linear Tracking Trainer</h1>
            <p style="color:var(--text-muted); margin-bottom: 3rem;">Keep your mouse inside the moving box.</p>

            <div style="font-size:1.5rem; margin-bottom:1rem">Accuracy: <span id="acc" style="color:#6366f1">100%</span>
            </div>

            <div class="arena" id="arena">
                <div class="path"></div>
                <div class="target-box" id="box"></div>
                <div class="cursor" id="cursor"></div>

                <div id="start"
                    style="position:absolute; inset:0; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:20; cursor:default">
                    <button class="join-pro-btn" style="width:auto" onclick="start()">START</button>
                </div>
            </div>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const arena = document.getElementById('arena');
        const box = document.getElementById('box');
        const cursor = document.getElementById('cursor');
        const accEl = document.getElementById('acc');
        const startDiv = document.getElementById('start');

        let isRunning = false;
        let t = 0;
        let frame = 0;
        let hits = 0;

        // Mouse tracking
        let mx = 0, my = 0;
        arena.onmousemove = e => {
            const rect = arena.getBoundingClientRect();
            mx = e.clientX - rect.left;
            my = e.clientY - rect.top;
            cursor.style.left = mx + 'px';
            cursor.style.top = my + 'px';
        };

        function start() {
            isRunning = true;
            startDiv.style.display = 'none';
            t = 0; frame = 0; hits = 0;
            loop();
        }

        function loop() {
            if (!isRunning) return;

            // Move Box (Sine wave horizontal)
            t += 0.02;
            const w = arena.clientWidth;
            const x = (Math.sin(t) + 1) / 2 * (w - 100) + 50;

            box.style.left = x + 'px';

            // Check Collision
            // Box Y is center (200). Size 60x60.
            // Center is x, 200.

            // Cursor distance
            const dx = Math.abs(x - mx);
            const dy = Math.abs(200 - my);

            frame++;
            if (dx < 30 && dy < 30) {
                // Inside
                hits++;
                box.style.borderColor = '#10b981';
            } else {
                box.style.borderColor = '#ef4444';
            }

            accEl.innerText = Math.round((hits / frame) * 100) + '%';

            if (t > 20) end(); // ~16s
            else requestAnimationFrame(loop);
        }

        function end() {
            isRunning = false;
            startDiv.style.display = 'flex';
            startDiv.innerHTML = `
                <div style='text-align:center'>
                    <h2>FINISHED</h2>
                    <p>Accuracy: ${accEl.innerText}</p>
                    <button class="join-pro-btn" style="width:auto; margin-top:1rem" onclick="start()">RETRY</button>
                </div>
            `;
        }
    </script>
</body>

</html>