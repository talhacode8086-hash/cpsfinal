<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Speed Test - AssetsToolsHub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tool-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .code-display {
            background: #0d1117;
            border: 1px solid var(--card-border);
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 2rem 0;
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            line-height: 1.8;
            color: #8b949e;
            text-align: left;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .char {
            transition: color 0.1s;
        }

        .char.correct {
            color: #a5d6ff;
            text-shadow: 0 0 5px rgba(165, 214, 255, 0.3);
        }

        .char.incorrect {
            color: #ff7b72;
            text-decoration: underline;
            background: rgba(255, 123, 114, 0.1);
        }

        .char.current {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 2px solid var(--primary);
        }

        .lang-selector {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            color: var(--text-muted);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            border-radius: 1.5rem;
            text-align: center;
        }

        .stat-val {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="main-content">
        <div class="tool-container">
            <h1 style="font-size: 2.5rem; font-weight:900; margin-bottom: 1rem; text-align: center;">Code Speed Test
                <span style="color:#fbbf24; font-size:1rem; vertical-align:middle; margin-left:10px">PRO</span></h1>
            <p style="color:var(--text-muted); margin-bottom: 3rem; text-align: center;">Test your typing speed on real
                syntactic structures.</p>

            <div class="lang-selector">
                <button class="lang-btn active" onclick="setLang('js')"><i data-lucide="file-code"></i>
                    JavaScript</button>
                <button class="lang-btn" onclick="setLang('py')"><i data-lucide="file-json"></i> Python</button>
                <button class="lang-btn" onclick="setLang('css')"><i data-lucide="palette"></i> CSS</button>
                <button class="lang-btn" onclick="setLang('html')"><i data-lucide="layout"></i> HTML</button>
            </div>

            <div class="code-display" id="codeArea" tabindex="0">
                <!-- Text injected here -->
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-val" id="wpm">0</div>
                    <div class="stat-label">WPM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="acc">100%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="timer">0s</div>
                    <div class="stat-label">Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="errors">0</div>
                    <div class="stat-label">Errors</div>
                </div>
            </div>

            <button class="join-pro-btn"
                style="width:100%; margin-top:2rem; padding:1.2rem; background: rgba(255,255,255,0.05)"
                onclick="reset()">RESTART TEST</button>
        </div>
    </div>

    <script src="layout.js"></script>
    <script>
        const snippets = {
            js: `function calculateArea(radius) {
  const PI = 3.14159;
  return PI * radius * radius;
}

const result = [1, 2, 3].map(x => x * 2);
console.log("Area:", calculateArea(5));`,
            py: `def binary_search(arr, target):
    low = 0
    high = len(arr) - 1
    while low <= high:
        mid = (low + high) // 2
        if arr[mid] == target:
            return mid
        elif arr[mid] < target:
            low = mid + 1
    return -1`,
            css: `.container {
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #f0f0f0;
  border-radius: 8px;
  padding: 2rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}`,
            html: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Page</title>
</head>
<body>
    <div class="header">
        <h1>Welcome</h1>
    </div>
</body>
</html>`
        };

        let currentText = "";
        let currentIndex = 0;
        let errors = 0;
        let startTime = 0;
        let isRunning = false;
        let timerParams = null; // Renamed to avoid conflict with standard window properties if any

        const area = document.getElementById('codeArea');
        const wpmEl = document.getElementById('wpm');
        const accEl = document.getElementById('acc');
        const timerEl = document.getElementById('timer');
        const errEl = document.getElementById('errors');
        const btns = document.querySelectorAll('.lang-btn');

        function setLang(lang) {
            btns.forEach(b => b.classList.remove('active'));
            document.querySelector(`button[onclick="setLang('${lang}')"]`).classList.add('active');
            currentText = snippets[lang];
            resetInternal();
        }

        function render() {
            area.innerHTML = '';
            currentText.split('').forEach((char, i) => {
                const span = document.createElement('span');
                span.innerText = char;
                span.className = 'char';
                if (i === currentIndex) span.classList.add('current');
                // Handle newlines visually
                if (char === '\n') span.innerHTML = 'â†µ<br>';
                // Handle text
                if (char === ' ') span.innerHTML = '&nbsp;';

                area.appendChild(span);
            });
        }

        function updateVisuals(lastIndex, wasCorrect) {
            const spans = area.querySelectorAll('.char');
            if (spans[lastIndex]) {
                spans[lastIndex].classList.remove('current');
                spans[lastIndex].classList.add(wasCorrect ? 'correct' : 'incorrect');
            }
            if (spans[currentIndex]) {
                spans[currentIndex].classList.add('current');
            }
        }

        function reset() {
            resetInternal();
        }

        function resetInternal() {
            clearInterval(timerParams);
            isRunning = false;
            currentIndex = 0;
            errors = 0;
            render();
            wpmEl.innerText = "0";
            accEl.innerText = "100%";
            timerEl.innerText = "0s";
            errEl.innerText = "0";
            document.getElementById('codeArea').focus();
        }

        window.addEventListener('keydown', (e) => {
            if (e.target !== document.body && e.target !== area) return;
            if (currentIndex >= currentText.length) return;

            // Ignore modifiers
            if (e.key.length > 1 && e.key !== 'Enter' && e.key !== 'Backspace') return;

            // Prevent scrolling space
            if (e.key === ' ') e.preventDefault();

            if (!isRunning) {
                isRunning = true;
                startTime = performance.now();
                timerParams = setInterval(() => {
                    const elapsed = (performance.now() - startTime) / 1000;
                    timerEl.innerText = Math.floor(elapsed) + "s";
                    const wpm = (currentIndex / 5) / (elapsed / 60);
                    wpmEl.innerText = Math.round(wpm);
                }, 500);
            }

            const targetChar = currentText[currentIndex];
            let inputChar = e.key;
            if (inputChar === 'Enter') inputChar = '\n';

            // Check correctness
            const isCorrect = inputChar === targetChar;

            if (!isCorrect) {
                errors++;
                errEl.innerText = errors;
            }

            // Move cursor
            updateVisuals(currentIndex, isCorrect);
            currentIndex++;

            // Update Accuracy
            const acc = ((currentIndex - errors) / currentIndex) * 100;
            accEl.innerText = Math.max(0, acc).toFixed(1) + "%";

            // Scroll if needed
            const currentSpan = area.querySelectorAll('.char')[currentIndex];
            if (currentSpan) {
                const offset = currentSpan.offsetTop;
                if (offset > area.scrollTop + 150) {
                    area.scrollTop = offset - 100;
                }
            }

            if (currentIndex >= currentText.length) {
                clearInterval(timerParams);
                area.innerHTML += "<br><br><div style='color:var(--primary); font-weight:800'>TEST COMPLETE!</div>";
            }
        });

        // Initialize default
        setLang('js');
    </script>
</body>

</html>